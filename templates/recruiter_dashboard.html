{% extends "base.html" %}
{% block content %}

<!-- Header -->
<div class="flex justify-between items-center mb-8">
    <div>
        <h2 class="text-3xl font-bold text-white">Recruiter Dashboard</h2>
        <p class="text-gray-400">Manage your jobs & applications</p>
    </div>

    <a href="{{ url_for('post_job') }}"
       class="btn-glow bg-emerald-600 hover:bg-emerald-500
              px-5 py-3 rounded-lg text-white font-semibold transition">
        âž• Post New Job
    </a>
</div>

<!-- Jobs Section -->
{% if jobs %}
<div class="grid md:grid-cols-2 gap-6">
    {% for job in jobs %}
    <div class="bg-white/5 backdrop-blur border border-white/10
                rounded-2xl p-6 hover:shadow-2xl hover:scale-[1.02]
                transition duration-300">

        <h3 class="text-xl font-semibold text-indigo-400">{{ job.title }}</h3>
        <p class="text-gray-300 mt-3 line-clamp-3">{{ job.description }}</p>

        <!-- Applications -->
        <div class="mt-5">
            {% if job.applications %}
                <p class="text-sm text-gray-400 mb-3">Applications ({{ job.applications|length }})</p>
                <div class="space-y-3 max-h-64 overflow-y-auto pr-2">

                    {% for app in job.applications %}
                    <div class="bg-white/10 p-3 rounded-lg border border-white/10 flex justify-between items-center">

                        <div>
                            <p class="text-white font-medium">{{ app.user.username }}</p>
                            <p class="text-sm text-gray-400">{{ app.user.email }}</p>
                            <p class="text-sm text-gray-300 mt-1">{{ app.cover_letter or "No cover letter provided." }}</p>
                            {% if app.resume %}
                                <a href="{{ url_for('static', filename='uploads/' ~ app.resume) }}"
                                   target="_blank"
                                   class="text-indigo-400 hover:underline text-sm">ðŸ“„ Open Resume</a>
                            {% endif %}
                        </div>

                        <!-- Accept / Reject Buttons -->
                        <div class="flex flex-col space-y-2">
                            <button onclick="openModal('modal-{{ app.id }}')"
                                    class="bg-green-600 hover:bg-green-500 text-white px-3 py-1 rounded-lg text-sm font-semibold">
                                Accept
                            </button>
                            <button onclick="openModal('modal-{{ app.id }}-reject')"
                                    class="bg-red-600 hover:bg-red-500 text-white px-3 py-1 rounded-lg text-sm font-semibold">
                                Reject
                            </button>
                        </div>

                        <!-- Accept Modal -->
                        <div id="modal-{{ app.id }}" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div class="bg-white rounded-lg p-6 w-11/12 md:w-1/2">
                                <h3 class="text-xl font-bold mb-2">Review Application</h3>
                                <p><strong>Applicant:</strong> {{ app.user.username }}</p>
                                <p><strong>Email:</strong> {{ app.user.email }}</p>
                                <p><strong>Cover Letter:</strong> {{ app.cover_letter or "No cover letter" }}</p>
                                {% if app.resume %}
                                <a href="{{ url_for('static', filename='uploads/' ~ app.resume) }}"
                                   target="_blank"
                                   class="text-indigo-600 underline">ðŸ“„ Open Resume</a>
                                {% endif %}
                                <div class="mt-4 flex justify-end space-x-2">
                                    <form method="POST" action="{{ url_for('accept_applicant', app_id=app.id) }}">
                                        <button type="submit" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg">Confirm Accept</button>
                                    </form>
                                    <button onclick="closeModal('modal-{{ app.id }}')" class="bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg">Cancel</button>
                                </div>
                            </div>
                        </div>

                        <!-- Reject Modal -->
                        <div id="modal-{{ app.id }}-reject" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div class="bg-white rounded-lg p-6 w-11/12 md:w-1/2">
                                <h3 class="text-xl font-bold mb-2">Reject Application?</h3>
                                <p><strong>Applicant:</strong> {{ app.user.username }}</p>
                                <p><strong>Email:</strong> {{ app.user.email }}</p>
                                <div class="mt-4 flex justify-end space-x-2">
                                    <form method="POST" action="{{ url_for('reject_applicant', app_id=app.id) }}">
                                        <button type="submit" class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-lg">Confirm Reject</button>
                                    </form>
                                    <button onclick="closeModal('modal-{{ app.id }}-reject')" class="bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg">Cancel</button>
                                </div>
                            </div>
                        </div>

                    </div>
                    {% endfor %}

                </div>
            {% else %}
                <p class="text-sm text-gray-500 mt-4">No applications yet.</p>
            {% endif %}
        </div>

    </div>
    {% endfor %}
</div>

{% else %}
<p class="text-gray-400">You haven't posted any jobs yet.</p>
{% endif %}

<script>
    function openModal(id){ document.getElementById(id).classList.remove('hidden'); }
    function closeModal(id){ document.getElementById(id).classList.add('hidden'); }
</script>

{% endblock %}
